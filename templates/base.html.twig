<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <script src="https://unpkg.com/feather-icons"></script>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
        {% endblock %}

        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body>
        <header class="header">
            <div class="header-content container mx-auto">
                <form method="GET" action="#" class="flex left-container items-center">
                    <a href="{{ path('front_default_index') }}">
                        <img class="logo" src="{{ asset('build/images/logo.png') }}" alt="logo">
                    </a>
                    <input name="search" type="text" class="search-bar w-full" value="{{ app.request.query.get('search') }}" placeholder="Que cherchez-vous ?">
                </form>

                <nav class="header-navigation space-x-5 max-lg:hidden">
                    <a class="hover:text-primary" href="{{ path('app_logout') }}">Se déconnecter</a>
                </nav>
            </div>
        </header>

        <div class="container mx-auto" style="margin-top: 100px">
            {% block body %}{% endblock %}
        </div>

        {% if notyf is defined %}
            <div id="notyf-message" class={{ notyf }}>{{ notyf }}</div>
        {% endif %}

        {%  include '/components/notyf.html.twig' %}
    </body>
    <footer>
    
    </footer>
    </body>
    <script>
        feather.replace()
        function notifyOffers(data) {
            console.log(data.offer);
            if (!("Notification" in window)) {
                // Check if the browser supports notifications
                alert("This browser does not support desktop notification");
            } else if (Notification.permission === "granted") {
                // Check whether notification permissions have already been granted;
                // if so, create a notification
                const options = {
                    vibrate: [200, 100, 200]
                }

                const notification = new Notification("Nouvelle offre !", {
                    body: data.offer,
                    tag: "simple-push-demo-notification",
                });
                notification.vibrate;

                // …
            } else if (Notification.permission !== "denied") {
                // We need to ask the user for permission
                Notification.requestPermission().then((permission) => {
                    // If the user accepts, let's create a notification
                    if (permission === "granted") {
                        const options = {
                            vibrate: [200, 100, 200]
                        }

                        const notification = new Notification("Nouvelle offre !", {
                            body: data.offer,
                            tag: "simple-push-demo-notification",
                        });
                        notification.vibrate;
                        // …
                    }
                });
            }
        }

        const eventSource = new EventSource("{{ mercure('http://localhost/books/1')|escape('js') }}");
        eventSource.onmessage = event => {
            // Will be called every time an update is published by the server

            notifyOffers(JSON.parse(event.data));
        }


    </script>
</html>
